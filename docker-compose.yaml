# base

include:
  - path:
    - docker-compose.infrastructure.yaml
services:
  # TRANSACTION MONITORING SERVICE
  tms:
    build:
      context: https://github.com/tazama-lf/tms-service.git#${TMS_BRANCH}
      args:
        - GH_TOKEN
    env_file:
      - env/tms.env
      - .env
    restart: always
    ports:
      - ${TMS_PORT}:3000
    depends_on:
      - redis
      - arango
      - nats

  # EVENT DIRECTOR
  ed:
    build:
      context: https://github.com/tazama-lf/event-director.git#${ED_BRANCH}
      args:
        - GH_TOKEN
    env_file:
      - env/ed.env
      - .env
    restart: always
    depends_on:
      - redis
      - arango
      - nats

  # TYPOLOGY PROCESSOR
  tp:
    build:
      context: https://github.com/tazama-lf/typology-processor.git#${TP_BRANCH}
      args:
        - GH_TOKEN
    env_file:
      - env/tp.env
      - .env
    restart: always
    depends_on:
      - redis
      - arango
      - nats

  # TRANSACTION AGGREGATION AND DECISIONING PROCESSOR
  tadp:
    build:
      context: https://github.com/tazama-lf/transaction-aggregation-decisioning-processor.git#${TADP_BRANCH}
      args:
        - GH_TOKEN
    env_file:
      - env/tadp.env
      - .env
    restart: always
    depends_on:
      - redis
      - arango
      - nats
  
  admin-service:
    build:
      context: https://github.com/frmscoe/admin-service.git#${ADMIN_BRANCH}
      args:
        - GH_TOKEN
    env_file:
      - env/admin.env
      - .env
    restart: always
    ports:
      - ${ADMIN_PORT}:3100
    depends_on:
      - arango
      - valkey

  ef:
    build:
      context: https://github.com/tazama-lf/event-flow.git#${EVENT_FLOW_BRANCH}
      args:
        - GH_TOKEN
    env_file:
      - env/event-flow.env
      - .env
    restart: always
    depends_on:
      - arango
      - valkey
